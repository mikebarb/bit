<div id="sticky-header">
  <h1 class="sticky-header__title"><%= @displayHeader %></h1>
  <img class="sticky-header__icon" src=""/>
  
  <div id="sticky-header__collapsible">
    <% listofsites = Array.new
       @cal.each do |location, calLocation| 
         listofsites.push(location)
       end
    %>
  
    <div id="options" class="hideme">
      <%= @options.to_json %>
    </div>
    
    <div id=refreshthis>Refresh Me</div>

    <div id="selectshows">
        <div class="checklisttutors">
          <input id=hidetutors class=selectshow onclick="selectshows()" type="checkbox" >Tutors
          <input id=hidestudents class=selectshow onclick="selectshows()" type="checkbox" >Students;
          Hide Comments=>(<input id=hidecomments class=selectshow onclick="selectshows()" type="checkbox" >All;
        </div>
        <div class=checklistlesson>
        Lesson=>(<input id=hidetutorlessoncomments class=selectshow onclick="selectshows()" type="checkbox" >tutors, 
        <input id=hidestudentlessoncomments class=selectshow onclick="selectshows()" type="checkbox" >students ), 
        </div>
        
        <div class=checklistpersonal>
        Personal=>(<input id=hidetutorcomments class=selectshow onclick="selectshows()" type="checkbox" >tutors,
        <input id=hidestudentcomments class=selectshow onclick="selectshows()" type="checkbox" >students )
        </div>)
        
        <div class=checklistlessons>
        Hide=>(<input id=hidelessonsOnsetup class=selectshow onclick="selectshows()" type="checkbox" >onSetup,
        <input id=hidelessonsOncall class=selectshow onclick="selectshows()" type="checkbox" >onCall )
        </div>
        
        <br>
        <input id=enableQuickStatus type="checkbox" > Enable quick setting of status to
        <select name="quickStatus" id="quickStatusValue">
          <option value="Attended">Attended</option>
          <option value="Confirmed">Confirmed</option>
          <option value="Notified">Notified</option>
          <option value="Scheduled">Scheduled</option>
          <option value="Deal">Deal</option>
          <option value="Absent">Absent</option>
          <option value="Away">Away</option>
        </select>
        <br>
        <% listofsites.each_with_index do |site, i| %>
        <div class="<%= "selectSite" + site %> jumptosite">
        <input id=<%= 'hide' + site %> class="selectshow selectsite" onclick="selectshows()" type="checkbox" ><%= site + "  " %> 
        </div>
        <% end %>
    </div>
    
    <div id="selectSetStatus">
    </div>
    
    
    <div class=index id=index-tutor-students>
        <div class="selectbox floating-box">
            <h2>Select person</h2>
            <input type="text" id="personInput" placeholder="Shorten list by keying in meaningful characters .." title="Type in characters to reduce name list">
        </div>
    
        <div class=index-tutors id=index-tutors>
            <% @tutors.each do |tutor| %>
              <%= render partial: "index_tutor", locals: {tutor: tutor} %>
            <% end %>
        </div>
    
        <div class=index-students id=index-students>
            <% @students.each do |student| %>
              <%= render partial: "index_student", locals: {student: student} %>
            <% end %>
        </div>
    </div>
  </div>
</div>
<div class=schedule>
<% @cal.each do |location, calLocation| 
  if @compress   # remove days with no valid slot for this site
   usedColumns = calLocation[0][0]["days"].keys
   usedColumnsIndex = [0]
   for i in 1..(calLocation[0].length-1)
     if usedColumns.include?(calLocation[0][i]["value"]) then
       usedColumnsIndex.push(i)
     end
   end 
  end %>
  <% firsttablecolumn = true %>
  <table id=site-<%= location %> >
  <% calLocation.each do |rows| %>
    <tr>
    <% rows.each_with_index do |cells, cellIndex|
      if @compress      
        unless usedColumnsIndex.include?(cellIndex) then
           next
        end 
      end %>
      <% if cells.key?("slotid") then %>
        <td class="cell slot" id=<%= cells["id_dom"] + "l" + cells["slotid"].rjust(@sf, "0") %>  >
      <% elsif cells.key?("value") then %>
        <% if firsttablecolumn == true then
          firsttablecolumn = false %>
          <td class="cell firsttablecolumn" %>
        <% else %>
          <td class="cell" %>
        <% end %>
      <% else %>
         <td class="cell no-slot" %>
      <% end %> 
      <% if cells.key?("values") then %>       
        <% if cells["values"].respond_to?(:each) then %>
          <% slot = cells["id_dom"] %>
          <% #cells["values"].sort_by {|obj| [valueOrderStatus(obj),valueOrder(obj)] }.each do |entry| %>
          <% cells["values"].each do |entry| %>
            <% lesson = entry.id %>
            <div class="lesson <%= 'n-status-' + set_class_status_f(entry) %>" id=<%= cells["id_dom"] + "n" + entry.id.to_s.rjust(@sf, "0") %> >
              <div class="grouptutors">
                <% #if entry.tutors.respond_to?(:each) then %>
                <% if @tutrole_lessonindex.has_key? entry.id then %>
                  <% #entry.tutors.sort_by {|obj| obj.pname }.each do |tutor| %>
                  <% @tutrole_lessonindex[entry.id].each do |tutroleInfo_index| %>
                    <% thistutrole = @tutroleinfo[tutroleInfo_index] %>
                    <% tutor = thistutrole.tutor %>
                    <% #if tutor then %>
                      <%= render partial: "schedule_tutor", 
                          locals: {tutor: tutor, thistutrole: thistutrole, slot: slot, lesson: lesson} %>
                    <% #end %>
                  <% end %>
                <% end %>
              </div>
              
              <div class="groupstudents">
                <% #if entry.students.respond_to?(:each) then %>
                <% if @role_lessonindex.has_key? entry.id then %>
                  <% #entry.students.each do |student| %>
                  <% @role_lessonindex[entry.id].each do |roleInfo_index| %>
                    <% thisrole = @roleinfo[roleInfo_index] %>
                    <% student = thisrole.student %>
                    <% if student then %>
                      <%= render partial: "schedule_student", 
                          locals: {student: student, thisrole: thisrole, slot: slot, lesson: lesson} %>
                    <% end %>
                  <% end %>
                <% end %>
              </div>

              <div class="lessoncomment comment commentinline">
                <div class="lessoncommenttext"><% if entry.comments != nil && entry.comments != "" %><%= entry.comments %><% end %></div>
                <div class="lessonstatusinfo"><% if entry.status != nil && entry.status != "" %>Status: <%= entry.status %> <% end %></div>
              </div>
               
            </div>
          <% end %>
        <% end %>
      <% elsif cells.key?("value") then %>     
        <%= cells["value"].to_s %>
      <% end %>
      </td>
    <% end %>
    </tr>
  <% end %>
  </table>
<% end %>
</div>

  <nav id="context-menu" class="context-menu">
    <ul class="context-menu__items">
      <li id="context-move" class="context-menu__item" data-action="move">
        <p>Move</p>
      </li>
      <li id="context-copy" class="context-menu__item" data-action="copy">
        <p>Copy</p>
      </li>
      <li id="context-paste" class="context-menu__item" data-action="paste">
        <p>Drop</p>
      </li>
      <li id="context-remove" class="context-menu__item" data-action="remove">
        <p>Remove</p>
      </li>
      <li id="context-addLesson" class="context-menu__item" data-action="addLesson">
        <p>Add Lesson</p>
      </li>    
      <li id="context-removeLesson" class="context-menu__item" data-action="removeLesson">
        <p>Remove Lesson</p>
      </li>    
      <li id="context-setStatus" class="context-menu__item" data-action="setStatus">
        <p>Set Status</p>
      </li>    
      <li id="context-setKind" class="context-menu__item" data-action="setKind">
        <p>Set Kind</p>
      </li>    
      <li id="context-setPersonStatus" class="context-menu__item" data-action="setPersonStatus">
        <p>Set Person Status</p>
      </li>    
      <li id="context-editComment" class="context-menu__item" data-action="editComment">
        <p>Edit Comment</p>
      </li>    
      <li id="context-editDetail" class="context-menu__item" data-action="editDetail">
        <p>Edit Detail</p>
      </li>    
      <li id="context-editSubject" class="context-menu__item" data-action="editSubject">
        <p>Edit Subject</p>
      </li>    
      <li id="context-history" class="context-menu__item" data-action="history">
        <p>History</p>
      </li>    
      <li id="context-changes" class="context-menu__item" data-action="changes">
        <p>Changes</p>
      </li>  
      <li id="context-editEntry" class="context-menu__item" data-action="editEntry">
        <p>Edit Entry</p>
      </li>  
    </ul>
  </nav>
  
  <nav id="tertiary-menu" class="tertiary-menu">
    <div id="tertiary=menu-title"> Tertiary Menu Title</div>
    <ul class="tertiary-menu__choices">
      <li id="tutor-status-scheduled" class="tertiary-menu__choice" data-choice="tutor-status-scheduled">
        <p>tutor-status: Scheduled</p>
      </li>
      <li id="tutor-status-notified" class="tertiary-menu__choice" data-choice="tutor-status-notified">
        <p>tutor-status: Notified</p>
      </li>
      <li id="tutor-status-confirmed" class="tertiary-menu__choice" data-choice="tutor-status-confirmed">
        <p>tutor-status: Confirmed</p>
      </li>
      <li id="tutor-status-attended" class="tertiary-menu__choice" data-choice="tutor-status-attended">
        <p>tutor-status: Attended</p>
      </li>
      <li id="tutor-status-deal" class="tertiary-menu__choice" data-choice="tutor-status-deal">
        <p>tutor-status: Deal</p>
      </li>
      <li id="tutor-status-absent" class="tertiary-menu__choice" data-choice="tutor-status-absent">
        <p>tutor-status: Absent</p>
      </li>
      <li id="tutor-status-away" class="tertiary-menu__choice" data-choice="tutor-status-away">
        <p>tutor-status: Away</p>
      </li>
      <li id="tutor-kind-bfl" class="tertiary-menu__choice" data-choice="tutor-kind-BFL">
        <p>tutor-kind: BFL</p>
      </li>
      <li id="tutor-kind-oncall" class="tertiary-menu__choice" data-choice="tutor-kind-onCall">
        <p>tutor-kind: On Call</p>
      </li>
      <li id="tutor-kind-onsetup" class="tertiary-menu__choice" data-choice="tutor-kind-onSetup">
        <p>tutor-kind: On Setup</p>
      </li>
      <li id="tutor-kind-training" class="tertiary-menu__choice" data-choice="tutor-kind-training">
        <p>tutor-kind: Training</p>
      </li>
      <li id="tutor-kind-standard" class="tertiary-menu__choice" data-choice="tutor-kind-standard">
        <p>tutor-kind: Standard</p>
      </li>
      <li id="tutor-kind-called" class="tertiary-menu__choice" data-choice="tutor-kind-called">
        <p>tutor-kind: Called</p>
      </li>
      <li id="tutor-kind-relief" class="tertiary-menu__choice" data-choice="tutor-kind-relief">
        <p>tutor-kind: Relief</p>
      </li>
      <li id="tutor-kind-fifteen" class="tertiary-menu__choice" data-choice="tutor-kind-fifteen">
        <p>tutor-kind: Fifteen</p>
      </li>
      <li id="student-status-scheduled" class="tertiary-menu__choice" data-choice="student-status-scheduled">
        <p>student-status: Scheduled</p>
      </li>
      <li id="student-status-attended" class="tertiary-menu__choice" data-choice="student-status-attended">
        <p>student-status: Attended</p>
      </li>
      <li id="student-status-bye" class="tertiary-menu__choice" data-choice="student-status-bye">
        <p>student-status: Bye</p>
      </li>
      <li id="student-status-deal" class="tertiary-menu__choice" data-choice="student-status-deal">
        <p>student-status: Deal</p>
      </li>
      <li id="student-status-absent" class="tertiary-menu__choice" data-choice="student-status-absent">
        <p>student-status: Absent</p>
      </li>
      <li id="student-status-away" class="tertiary-menu__choice" data-choice="student-status-away">
        <p>student-status: Away</p>
      </li>
      <li id="student-kind-free" class="tertiary-menu__choice" data-choice="student-kind-free">
        <p>student-kind: Free</p>
      </li>
      <li id="student-kind-first" class="tertiary-menu__choice" data-choice="student-kind-first">
        <p>student-kind: First</p>
      </li>
      <li id="student-kind-catchup" class="tertiary-menu__choice" data-choice="student-kind-catchup">
        <p>student-kind: CatchUp</p>
      </li>
      <li id="student-kind-fortnightly" class="tertiary-menu__choice" data-choice="student-kind-fortnightly">
        <p>student-kind: Fortnightly</p>
      </li>
      <li id="student-kind-onetoone" class="tertiary-menu__choice" data-choice="student-kind-onetoone">
        <p>student-kind: OneToOne</p>
      </li>
      <li id="student-kind-standard" class="tertiary-menu__choice" data-choice="student-kind-standard">
        <p>student-kind: Standard</p>
      </li>
      <li id="student-kind-bonus" class="tertiary-menu__choice" data-choice="student-kind-bonus">
        <p>student-kind: Bonus</p>
      </li>
      <li id="student-personstatus-new" class="tertiary-menu__choice" data-choice="student-personstatus-new">
        <p>personStatus: New</p>
      </li>
      <li id="student-personstatus-fortnightly" class="tertiary-menu__choice" data-choice="student-personstatus-fortnightly">
        <p>personStatus: Fortnightly</p>
      </li>
      <li id="student-personstatus-onetoone" class="tertiary-menu__choice" data-choice="student-personstatus-onetoone">
        <p>personStatus: One To One</p>
      </li>
      <li id="student-personstatus-standard" class="tertiary-menu__choice" data-choice="student-personstatus-standard">
        <p>personStatus: Standard</p>
      </li>
      <li id="student-personstatus-inactive" class="tertiary-menu__choice" data-choice="student-personstatus-inactive">
        <p>personStatus: Inactive</p>
      </li>
      <li id="lesson-status-oncall" class="tertiary-menu__choice" data-choice="lesson-status-onCall">
        <p>lesson-status: onCall</p>
      </li>
      <li id="lesson-status-onsetup" class="tertiary-menu__choice" data-choice="lesson-status-onSetup">
        <p>lesson-status: onSetup</p>
      </li>
      <li id="lesson-status-free" class="tertiary-menu__choice" data-choice="lesson-status-free">
        <p>lesson-status: free</p>
      </li>
      <li id="lesson-status-on_BFL" class="tertiary-menu__choice" data-choice="lesson-status-on_BFL">
        <p>lesson-status: on BFL</p>
      </li>
      <li id="lesson-status-standard" class="tertiary-menu__choice" data-choice="lesson-status-standard">
        <p>lesson-status: standard</p>
      </li>
      <li id="lesson-status-routine" class="tertiary-menu__choice" data-choice="lesson-status-routine">
        <p>lesson-status: routine</p>
      </li>
      <li id="lesson-status-flexible" class="tertiary-menu__choice" data-choice="lesson-status-flexible">
        <p>lesson-status: flexible</p>
      </li>
      <li id="lesson-status-allocate" class="tertiary-menu__choice" data-choice="lesson-status-allocate">
        <p>lesson-status: allocate</p>
      </li>
      <li id="lesson-status-global" class="tertiary-menu__choice" data-choice="lesson-status-global">
        <p>lesson-status: global</p>
      </li>
      <li id="lesson-status-park" class="tertiary-menu__choice" data-choice="lesson-status-park">
        <p>lesson-status: park</p>
      </li>
      <li id="edit-comment" class="tertiary-menu__choice" data-choice="edit-comment">
          <textarea id="edit-comment-text">Test Only.</textarea>
          <button id="edit-comment-button">Update</button>
          <div id="edit-comment-elementid" class="hideme"></div>
      </li>
      <li id="edit-subject" class="tertiary-menu__choice" data-choice="edit-subject">
          <textarea id="edit-subject-text">Test Only.</textarea>
          <button id="edit-subject-button">Update</button>
          <div id="edit-subject-elementid" class="hideme">
            
          </div>
      </li>
    </ul>
  </nav>

  <div class="lesson hideme" id=lessontemplate >
    <div class="grouptutors"></div>
    <div class="groupstudents"></div>
    <div class="lessoncomment comment commentinline">
      <div class="lessoncommenttext"></div>
      <div class="lessonstatusinfo">Status: standard </div>
  </div>
  </div>

  <div id="histories" class="histories"  >
    <div id="history-template" class="history ui-widget-content hideme"></div>
  </div>


